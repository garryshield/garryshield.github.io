$("[data-fancybox]").fancybox({loop:!0,buttons:["zoom","slideShow","fullScreen","download","close"],baseClass:"fancybox-custom"}),window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"日志",PAGES:"文章",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"其它"},CONTENT_URL:"/content.json"},function(){var n=$(".article").find("h1, h2, h3, h4, h5, h6");n.on("click",function(){$(this).get(0).id&&(window.location.hash=$(this).get(0).id)});var t=$(".catalog");if(t.length){n.addClass("heading"),n=$(".article").find(".heading");var e=$(".catalog-inn"),a=t.offset().top,i=$("<div/>"),s=0;n.each(function(){var n=$('<a href="#'+$(this).attr("id")+'">'+$(this).text()+"</a>"),t=$("<li/>").html(n),e=parseInt(this.tagName.substring(1));s<e?i.append($("<ol/>").append(t)):e<s?i.parents("ol:eq("+(s-e-1)+")").append(t):i.parent().append(t),i=t,s=e}),i=i.parents("ol:last"),e.html(i),n.removeAttr("class"),$(window).scroll(o),o()}function o(){$(window).scrollTop()>a?t.addClass("fixed"):t.removeClass("fixed")}}(),function(s,o){var e=s(".ins-search"),n=e.find(".ins-search-input"),i=e.find(".ins-section-wrapper"),r=e.find(".ins-section-container");function c(n,t,e,a,i){return s("<div>").addClass("ins-selectable").addClass("ins-search-item").append(s("<header>").append(s("<i>").addClass("fa").addClass("fa-"+n)).append(s("<span>").addClass("ins-title").text(null!=t&&""!==t?t:o.TRANSLATION.UNTITLED)).append(e?s("<span>").addClass("ins-slug").text(e):null)).append(a?s("<p>").addClass("ins-search-preview").text(a):null).attr("data-url",i)}function a(t,n){var e,a,i;if(0===n.length)return null;switch(e=o.TRANSLATION[t],t){case"POSTS":case"PAGES":a=n.map(function(n){return c("file",n.title,null,n.text.slice(0,150),n.link)});break;case"CATEGORIES":case"TAGS":a=n.map(function(n){return c("CATEGORIES"===t?"folder":"tag",n.name,n.slug,null,n.link)});break;default:return null}return(i=e,s("<section>").addClass("ins-section").append(s("<header>").addClass("ins-section-header").text(i))).append(a)}function l(n){return n.split(" ").filter(function(n){return!!n}).map(function(n){return n.toUpperCase()})}function u(n,e,a){var t=l(n);return t.filter(function(t){return 0<a.filter(function(n){return!!e.hasOwnProperty(n)&&(-1<e[n].toUpperCase().indexOf(t)||void 0)}).length}).length===t.length}function f(n,i,t,s){var o=0;return l(n).forEach(function(n){var a=new RegExp(n,"img");t.forEach(function(n,t){if(i.hasOwnProperty(n)){var e=i[n].match(a);o+=e?e.length*s[t]:0}})}),o}function d(n,t){var e,a,i=(e=t,{POST:function(n){return f(e,n,["title","text"],[3,1])},PAGE:function(n){return f(e,n,["title","text"],[3,1])},CATEGORY:function(n){return f(e,n,["name","slug"],[1,1])},TAG:function(n){return f(e,n,["name","slug"],[1,1])}}),s=(a=t,{POST:function(n){return u(a,n,["title","text"])},PAGE:function(n){return u(a,n,["title","text"])},CATEGORY:function(n){return u(a,n,["name","slug"])},TAG:function(n){return u(a,n,["name","slug"])}}),o=n.posts,r=n.pages,c=n.tags,l=n.categories;return{posts:o.filter(s.POST).sort(function(n,t){return i.POST(t)-i.POST(n)}).slice(0,5),pages:r.filter(s.PAGE).sort(function(n,t){return i.PAGE(t)-i.PAGE(n)}).slice(0,5),categories:l.filter(s.CATEGORY).sort(function(n,t){return i.CATEGORY(t)-i.CATEGORY(n)}).slice(0,5),tags:c.filter(s.TAG).sort(function(n,t){return i.TAG(t)-i.TAG(n)}).slice(0,5)}}function t(n){var t=s.makeArray(r.find(".ins-selectable")),e=-1;t.forEach(function(n,t){s(n).hasClass("active")&&(e=t)});var a=(t.length+e+n)%t.length;s(t[e]).removeClass("active"),s(t[a]).addClass("active"),function(n){if(0!==n.length){var t=i[0].clientHeight,e=n.position().top-i.scrollTop(),a=n[0].clientHeight+n.position().top;a>t+i.scrollTop()&&i.scrollTop(a-i[0].clientHeight),e<0&&i.scrollTop(n.position().top)}}(s(t[a]))}function p(n){n&&n.length&&(location.href=n.attr("data-url"))}e.parent().remove(".ins-search"),s("body").append(e),s.getJSON(o.CONTENT_URL,function(t){"#ins-search"===location.hash.trim()&&e.addClass("show"),n.on("input",function(){var n=s(this).val();!function(n){for(var t in r.empty(),n)r.append(a(t.toUpperCase(),n[t]))}(d(t,n))}),n.trigger("input")});var h=!1;s(document).on("click focus",".navbar .search",function(){e.addClass("show"),e.find(".ins-search-input").focus()}).on("click touchend",".ins-search-item",function(n){("click"===n.type||h)&&(p(s(this)),h=!1)}).on("click touchend",".ins-close",function(n){("click"===n.type||h)&&(e.removeClass("show"),h=!1)}).on("keydown",function(n){if(e.hasClass("show"))switch(n.keyCode){case 27:e.removeClass("show");break;case 38:t(-1);break;case 40:t(1);break;case 13:p(r.find(".ins-selectable.active").eq(0))}}).on("touchstart",function(n){h=!0}).on("touchmove",function(n){h=!1})}(jQuery,window.INSIGHT_CONFIG);